function initFirebase(){firebase.initializeApp({apiKey:"AIzaSyBrd4PqBBQwVVZwiPiLgsYiAI6vaSkAhHk",authDomain:"remoteforgs.firebaseapp.com",databaseURL:"https://remoteforgs.firebaseio.com",projectId:"remoteforgs",storageBucket:"remoteforgs.appspot.com",messagingSenderId:"602692243423"})}function getRandomSlideID(){return Math.floor(9e5*Math.random())+1e5}function getSlidesData(){var e=firebase.database().ref("/slides/"+slideid);if(e.getRoot().child(".info/connected").on("value",function(t){t.val()&&e.once("value").then(function(e){e.val().offline&&getSlidesData()})}),e.onDisconnect().set({offline:!0,timestamp:parseInt(Date.now()),type:origin}),"ludus"==origin){var t=document.querySelector('[property="og:title"]').content,n=parseInt(document.querySelector("#current-slide").innerHTML),i=parseInt(document.querySelector("#total-slides").innerHTML);e.set({current_slide:n,total_slide:i,title:t,type:origin}),chrome.runtime.sendMessage({from:"content",subject:"showNotification",msg:`Enter code -  ${slideid} in s.limhenry.xyz`}),changeSlides()}else{t=document.querySelector('meta[property="og:title"]').content,n=parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-posinset")),i=parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-setsize"));var o=viewerData.docData[1][n-1][8],r=document.querySelector("#rfgs_id_container");if(e.set({type:origin}),r)document.querySelector("#rfgs_id_container").innerHTML=slideid,e.set({current_slide:parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-posinset")),total_slide:i,title:t,speaker_note:o,type:origin}),changeSlides();else{var s=document.querySelector(".punch-viewer-nav-rounded-container"),a=document.createElement("div");a.className="goog-toolbar-separator goog-toolbar-separator-disabled goog-inline-block";var d=document.createElement("div");d.className="goog-toolbar-separator goog-toolbar-separator-disabled goog-inline-block";var c=document.createElement("div");c.className="goog-inline-block goog-flat-button",c.style.margin="0 4px",c.style.padding="0",c.innerHTML='\n                <div class="goog-inline-block goog-flat-button">\n                    <div class="punch-viewer-captioned-button" id="rfgs_show_id">\n                        <div style="width:24px; height:24px">\n                            <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%; fill: #cacaca;"><g><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></g></svg>\n                        </div>\n                        <div class="punch-viewer-speaker-notes-text goog-inline-block">Show ID & Start Remote</div>\n                    </div>\n                </div>\n                <div class="goog-inline-block goog-flat-button" style="text-align: center; line-height: 16px;">\n                    <div>Slide ID:</div>\n                    <div id="rfgs_id_container" style="font-size: 16px; font-weight: 600;">******</div>\n                </div>\n                <div class="goog-inline-block goog-flat-button" style="text-align: center; font-size: 11px; line-height: 16px;">\n                    Remote for Slides:<br>\n                    <span style="font-size: 14px">https://s.limhenry.xyz</span>\n                </div>';var l=document.createElement("div");l.style.display="inline-block",l.innerHTML='\n                <div class="goog-inline-block goog-flat-button">\n                    <div class="punch-viewer-captioned-button" id="rfgs_refresh_id">\n                        <div style="width:24px; height:24px">\n                            <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%; fill: #cacaca;"><g><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></g></svg>\n                        </div>\n                        <div class="punch-viewer-speaker-notes-text goog-inline-block">Refresh ID</div>\n                    </div>\n                </div>\n                <div class="goog-inline-block goog-flat-button" id="rfgs_stop_remote_container" style="display: none">\n                    <div class="punch-viewer-captioned-button" id="rfgs_stop_remote">\n                        <div style="width:24px; height:24px">\n                            <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%; fill: #cacaca;"><g><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></g></svg>\n                        </div>\n                        <div class="punch-viewer-speaker-notes-text goog-inline-block">Stop Remote</div>\n                    </div>\n                </div>',s.appendChild(a),s.appendChild(c),s.appendChild(d),s.appendChild(l),document.querySelector("#rfgs_refresh_id").addEventListener("click",function(){chrome.storage.sync.remove(docsID,function(e){firebase.database().ref("/slides/"+slideid).remove(),slideid=getRandomSlideID(),connectToFirebase(),setTimeout(function(){document.querySelector("#rfgs_show_id .punch-viewer-speaker-notes-text").innerHTML="Show ID",document.querySelector("#rfgs_id_container").innerHTML="******"},1e3)})}),document.querySelector("#rfgs_stop_remote").addEventListener("click",function(){fbRef.child("current_slide").off("value",console.log()),document.querySelector("#rfgs_id_container").innerHTML="-",document.querySelector("#rfgs_show_id .punch-viewer-speaker-notes-text").innerHTML="Show ID & Start Remote",firebase.database().ref("/slides/"+slideid).set({offline:!0,timestamp:parseInt(Date.now()),type:origin})}),document.querySelector("#rfgs_show_id").addEventListener("click",function(){document.querySelector("#rfgs_stop_remote_container").style.display="inline-block",document.querySelector("#rfgs_show_id .punch-viewer-speaker-notes-text").innerHTML="Hide ID",document.querySelector("#rfgs_id_container").innerHTML=slideid,changeSlides(),e.set({current_slide:parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-posinset")),total_slide:i,title:t,speaker_note:o,type:origin}),setTimeout(function(){document.querySelector("#rfgs_show_id .punch-viewer-speaker-notes-text").innerHTML="Show ID",document.querySelector("#rfgs_id_container").innerHTML="******"},1e3)})}}}function changeSlides(){(fbRef=firebase.database().ref("slides/"+slideid)).child("current_slide").on("value",function(e){fbRef.once("value").then(function(e){var t=e.val();if("ludus"==origin){var n=parseInt(document.querySelector("#current-slide").innerHTML);t.current_slide!=n&&(t.current_slide>n?(firebase.database().ref("/slides/"+slideid+"/current_slide").set(n+1),window.postMessage("nextSlide",location.origin)):t.current_slide<n&&(firebase.database().ref("/slides/"+slideid+"/current_slide").set(n-1),window.postMessage("previousSlide",location.origin)),firebase.database().ref("/slides/"+slideid+"/timestamp").set(parseInt(Date.now())))}else{n=parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-posinset"));if(t&&t.current_slide!=n){var i=new MutationObserver(function(e){slideNumber=parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-posinset"));var t=viewerData.docData[1][slideNumber-1][8];firebase.database().ref("/slides/"+slideid+"/current_slide").set(slideNumber),firebase.database().ref("/slides/"+slideid+"/speaker_note").set(t),i.disconnect()}),o=new MutationObserver(function(e){slideNumber=parseInt(document.querySelector(".goog-flat-menu-button-caption").getAttribute("aria-posinset"));var t=viewerData.docData[1][slideNumber-1][8];firebase.database().ref("/slides/"+slideid+"/current_slide").set(slideNumber),firebase.database().ref("/slides/"+slideid+"/speaker_note").set(t),o.disconnect()}),r={attributes:!0,childList:!0,characterData:!0,subtree:!0};if(t.current_slide>n){var s=-50,a=n+1;viewerData.docData[1][a-1][8];i.observe(document.querySelector(".punch-viewer-content"),r)}else if(t.current_slide<n){s=50,a=n-1,viewerData.docData[1][a-1][8];i.observe(document.querySelector(".punch-viewer-content"),r),o.observe(document.querySelector(".goog-flat-menu-button-caption"),r)}firebase.database().ref("/slides/"+slideid+"/timestamp").set(parseInt(Date.now()));var d=document.createElement("script");d.textContent="("+function(e){var t=document.querySelector(".punch-viewer-container"),n=document.createEvent("Events");n.initEvent("mousewheel",!0,!1),n.wheelDelta=e,t.dispatchEvent(n)}+')("'+s+'", )',(document.head||document.documentElement).appendChild(d),d.parentNode.removeChild(d)}}})})}function connectToFirebase(){chrome.storage.sync.get(docsID,function(e){0===Object.keys(e).length?firebase.database().ref("/slides/"+slideid).once("value").then(function(e){if(e.val())slideid=getRandomSlideID(),connectToFirebase();else{var t={};t[docsID]=slideid,chrome.storage.sync.set(t),getSlidesData()}}):firebase.database().ref("/slides/"+e[docsID]).once("value").then(function(t){t.val()?(slideid=e[docsID],getSlidesData()):chrome.storage.sync.remove(docsID,function(e){slideid=getRandomSlideID(),connectToFirebase()})})})}var origin,docsID,slideid,fbRef;if("slides.limhenry.xyz"==window.location.host){var isInstalledNode=document.createElement("div");isInstalledNode.id="extension-is-installed",document.body.appendChild(isInstalledNode)}else if("app.ludus.one"==window.location.host){if((script=document.createElement("script")).id="tmpScript",scriptContent="document.querySelector('body').setAttribute('presentationid', window.presentationId);",script.appendChild(document.createTextNode(scriptContent)),(document.body||document.head||document.documentElement).appendChild(script),docsID=document.querySelector("body").getAttribute("presentationid"),document.querySelector("#tmpScript").remove(),document.querySelector("body").removeAttribute("presentationid"),"ludus_viewer"==window.name){origin="ludus",slideid=getRandomSlideID(),initFirebase();function waitForElementToDisplay(){null==document.querySelector("#current-slide")?setTimeout(function(){waitForElementToDisplay()},500):connectToFirebase()}waitForElementToDisplay()}}else if(window.location.pathname.indexOf("/edit")>0){var title_bar=document.querySelector(".docs-titlebar-buttons"),btn_container=document.createElement("a");btn_container.href=window.location.href.replace("edit","present"),btn_container.className="goog-inline-block jfk-button jfk-button-standard docs-titlebar-button",btn_container.style.marginRight="0",btn_container.style.cursor="pointer",btn_container.style.textDecoration="none",btn_container.style.color="black";var label_container=document.createElement("span");label_container.innerHTML="Present with Remote",btn_container.appendChild(label_container),title_bar.insertBefore(btn_container,title_bar.childNodes[0])}else if(window.location.pathname.indexOf(window.location.href.replace("https://docs.google.com/presentation/d/","").split("/")[0]+"/present")>0){origin="gslides",docsID=window.location.href.replace("https://docs.google.com/presentation/d/","").split("/")[0],slideid=getRandomSlideID();var script;(script=document.createElement("script")).id="tmpScript",scriptContent="document.querySelector('body').setAttribute('viewerData', JSON.stringify(viewerData))",script.appendChild(document.createTextNode(scriptContent)),(document.body||document.head||document.documentElement).appendChild(script);var viewerData=JSON.parse(document.querySelector("body").getAttribute("viewerData"));document.querySelector("#tmpScript").remove(),document.querySelector("body").removeAttribute("viewerData"),initFirebase(),connectToFirebase()}